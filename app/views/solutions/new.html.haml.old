= render 'layouts/header', render_shadow: false
%div{class: "mt-10 flex flex-wrap justify-center pb-20"}
  = form_for @solution do |f|
    %div{class: "max-w-screen-lg w-full relative flex overflow-hidden"}
      %div{class: "text-2xl font-bold"}
        üë®‚Äçüî¨¬†üë®‚Äçüåæ Who is your solution relevant to?

    -# 2 Column
    %div{class: "mt-6 max-w-screen-lg w-full relative flex items-start"}
      -# Left Column
      %div{class: "w-full mr-6"}
        %div{class: "p-4 bg-white rounded-sm shadow-sm text-sm"}
          -# %div{class: "text-lg font-medium"}
          -#   Choose niches to post your solution to
          %div{class: " font-medium"}
            Industry niches
          %input{id: "industry_input",
                type: "text",
                onfocusout: "updateIndustries()",
                class: "mt-2 block text-gray-900 w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",
                hover: "border-indigo-300 ring ring-indigo-200 ring-opacity-50",
                placeholder: "Ex: 611110, 611210, 611310"}

          %div{class: "mt-3 font-medium"}
            Occupation niches
          %input{id: "occupation_input",
                type: "text",
                onfocusout: "updateOccupations()",
                class: "mt-2 block text-gray-900 w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",
                hover: "border-indigo-300 ring ring-indigo-200 ring-opacity-50",
                placeholder: "Ex: 25-2031, 25-2021, 25-2022"}
          %div{class: "text-xs text-gray-600 mt-3"}
            Unsure of what niche to post to?
            = link_to 'Explore', industry_categories_path, class: "mx-0.5 underline hover:text-black"
            or search to find relevant niches.
          %div{class: "mt-3 text-xs text-gray-600"}
            Only post to relevant niches. You can make a new solution
            with the same product which highlights different use-cases for different niches.

      -# Right Column
      %div{class: "w-1/2 flex-shrink-0 flex"}
        -# = render 'solutions/show', solution: @solution
        %div{class: "p-4 bg-white rounded-sm shadow-sm text-sm w-full max-h-64 overflow-y-auto"}
          %div{class: "text-lg font-medium"}
            Your solution will be posted to
          %div{class: "mt-2 flex flex-wrap"}
            - niche_class = "list-disc"
            %div{class: "w-1/2"}
              %div{class: "font-medium"}
                Industry niches
              %div{class: niche_class, id: "industry_niches"}
            %div{class: "w-1/2"}
              %div{class: "font-medium"}
                Occupation niches
              %div{class: niche_class, id: "occupation_niches"}
          -# %div{class: "text-xs text-gray-600"}
          -#   Seperate more than one niche with a comma. Only post to niches where your solution is relevant to that niche. Ex:

    -# Overview Section
    %div{class: "mt-10 max-w-screen-lg w-full relative flex overflow-hidden"}
      %div{class: "text-2xl font-bold"}
        üåÑ The overview of your solution
    %div{class: "mt-6 max-w-screen-lg w-full relative flex items-center"}
      -# Left Column
      %div{class: "w-full mr-6"}
        %div{class: "p-4 bg-white rounded-sm shadow-sm text-sm"}
          %div{class: "flex items-center"}
            %div{class: "font-medium"}
              Problem title
            %div{class: "ml-2 text-gray-600"}
              = "- Required"
          %input{id: "title",
              type: "text",
              class: "mt-2 block text-gray-900 w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",
              hover: "border-indigo-300 ring ring-indigo-200 ring-opacity-50",
              placeholder: "Manage / Organise / Increase / Improve / Simplify ..."}


      -# Right Column
      %div{class: "w-1/2 flex-shrink-0 flex flex-col"}
        Preview will go here


    -# Solution Section
    %div{class: "mt-10 max-w-screen-lg w-full relative flex overflow-hidden"}
      %div{class: "text-2xl font-bold"}
        ü§ì Tell us about your solution
    %div{class: "mt-6 max-w-screen-lg w-full relative items-start flex"}
      -# Left Column
      %div{class: "w-full mr-6"}
        %div{class: "p-4 bg-white rounded-sm shadow-sm text-sm"}
          %div{class: "flex items-center"}
            %div{class: "font-medium"}
              YouTube video
            %div{class: "ml-2 text-gray-600"}
              = "- Required"
          #videos
            %input{id: "youtube_url",
                type: "text",
                class: "mt-2 block text-gray-900 w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",
                hover: "border-indigo-300 ring ring-indigo-200 ring-opacity-50",
                placeholder: "Video of the solution"}
            = f.fields_for :youtube_urls do |builder|
              = render 'solutions/youtube_url', f: builder
          %div{class: "text-blue-500 hover:underline mt-1 text-xs"}
            = link_to_add_field('Add another video', f, :youtube_urls, class: "", id: "add_video")
      -# Right Column
      %div{class: "w-1/2 flex-shrink-0 flex flex-col"}


:javascript
  function updateIndustries() {
    $.ajax({
      method: "GET",
      url: "preview_industries",
      data: { niches: document.getElementById("industry_input").value }
    })
  }

  function updateOccupations() {
    $.ajax({
      method: "GET",
      url: "preview_occupations",
      data: { niches: document.getElementById("occupation_input").value }
    })
  }

  $( document ).on('turbolinks:load', function() {

    $("#add_video").on('click', function() {
      var regexp, time;
      time = new Date().getTime();
      regexp = new RegExp($(this).data('id'), 'g');
      $('#videos').append($(this).data('fields').replace(regexp, time));
      return event.preventDefault();
    })

    $("#videos").on('click', '.remove_url', function(event) {
      $(this).prev('input[type=hidden]').val('1');
      $(this).closest('div').hide();
      return event.preventDefault();
    });
  })

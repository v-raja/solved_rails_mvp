-# = render 'layouts/header', render_shadow: false
- @render_shadow = false
%div{class: "flex flex-wrap justify-center px-4", data: { controller: "data-binding"} }
  = form_with model: @solution, html: {class: ""} do |f|
    -# 2 Column
    %div{class: "max-w-screen-lg w-full relative flex items-start"}
      -# Left Column
      %div{class: "w-2/3 mr-6 pr-6"}
        %div{class: "mt-10"}
        - if @solution.errors.any?
          %ul{class: "mb-2 list-inside list-disc text-red-500"}
            - @solution.errors.full_messages.each do |msg|
              = content_tag(:li, msg)
        %div{class: "text-2xl font-bold"}
          ðŸŒ„ Solution overview
        %div{class: "mt-6 p-4 bg-white rounded-sm shadow-sm text-sm"}
          %div{class: "text-lg font-medium"}
            What product does your solution use?
          %div{class: "mt-1 w-full"}
            %div{class: "mt-4 flex items-end"}
              = image_tag @solution.product.thumbnail_url, class: "w-20 h-20"
              %div{class: "ml-2 text-2xl font-semibold leading-none "}
                = @solution.product.name
            %div{class: "mt-2 text-gray-600"}
              You cannot edit the product after posting.

        -# = content_for :head do
        = javascript_pack_tag "select2"



        %div{class: "mt-6 p-4 bg-white rounded-sm shadow-sm text-sm"}
          %div{class: "flex items-center"}
            %div{class: "font-medium"}
              Problem title
            %div{class: "ml-2 text-gray-600"}
              = "- Required"
          = f.text_field :title,
              class: "mt-1 block text-gray-900 w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 hover:border-indigo-300 hover:ring hover:ring-indigo-200 hover:ring-opacity-50",
              placeholder: "Manage / Organise / Increase / Improve / Simplify ..."

          %div{class: "text-gray-600 text-xs mt-1"}
            Try to skip words like "How to" and concisely state the problem you're solving.

          %div{class: "mt-4 flex items-center"}
            %div{class: "font-medium"}
              Tags

          %input{id: "tags",
              data: {action: "change->data-binding#update", binding: { initial: "#{params.dig(:tags_string).blank? ? 'false' : 'true'}", target: "tags", property: "textContent", value: "$source.value", debug: "true"}},
              type: "text",
              name: "tags_string",
              value: params[:tags_string],
              class: "mt-2 block text-gray-900 w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",
              hover: "border-indigo-300 ring ring-indigo-200 ring-opacity-50",
              placeholder: "Ex: remote management, sales, design request management"}
          %div{class: "text-gray-600 text-xs mt-1"}
            Tags make it easier for people to find your solution through search. Use niche-specific words that your target audience will understand at a glance.

        %div{class: "mt-10 text-2xl font-bold"}
          ðŸ¤“ Tell us about your solution
        %div{class: "mt-6 p-4 bg-white rounded-sm shadow-sm text-sm"}
          %div{class: "flex items-center"}
            %div{class: "font-medium"}
              YouTube video
            %div{class: "ml-2 text-gray-600"}
              = "- Required"
          #videos
            = f.fields_for :youtube_urls do |builder|
              = render 'solutions/youtube_url', f: builder
          %div{class: "text-blue-500 hover:underline mt-1 text-xs"}
            = link_to_add_field('Add video', f, :youtube_urls, class: "", id: "add_video")
          -# %div{class: "text-gray-600 text-xs mt-1"}
          -#   Preview not available



          %div{class: "mt-6 flex items-center"}
            %div{class: "font-medium"}
              Description
            %div{class: "ml-2 text-gray-600"}
              = "- Required"
          = f.text_area :description,
              class: "mt-1 block text-gray-900 w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 hover:border-indigo-300 hover:ring hover:ring-indigo-200 hover:ring-opacity-50",
              placeholder: "Manage / Organise / Increase / Improve / Simplify ...",
              data: {action: "change->data-binding#update"}, "data-binding-target": "description", "data-binding-property": "textContent", "data-binding-value": "$source.value", "data-binding-debug": "true", "data-binding-initial": "#{params.dig(:solution, :description).blank? ? "false" : "true"}",
              rows: "10"
          %div{class: "mt-1"}
            Formatting: **<strong>bold</strong>**, *<em>italic</em>*, [this will be a link](https://www.example.com)

        %div{class: "mt-6 p-4 bg-white rounded-sm shadow-sm text-sm"}
          %div{class: "flex items-center"}
            %div{class: "font-medium"}
              Product url
            %div{class: "ml-2 text-gray-600"}
              = "- Required"
          = f.text_field :get_it_url,
              class: "mt-1 block text-gray-900 w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 hover:border-indigo-300 hover:ring hover:ring-indigo-200 hover:ring-opacity-50",
              placeholder: "https://"
          %div{class: "text-gray-600 text-xs mt-1"}
            A link to learn more or purchase the product. This can be an affiliate link.


        %div{class: "mt-10 text-2xl font-bold"}
          ðŸ‘¨â€ðŸ”¬Â ðŸ‘¨â€ðŸŒ¾ Who is your solution relevant to?
        %div{class: "mt-6 p-4 bg-white rounded-sm shadow-sm text-sm"}
          -# = f.select :niche_list, options_from_collection_for_select(@solution.niche_list, 'code', 'title', selected: ""), {}, multiple: true, id: "test", class: "w-full"
          - options = options_for_select @solution.niche_list.map{ |n| [n.title, n.code, { title: n.title, 'selected' => 'selected' }] }
          = f.select :niche_list,  options, {}, multiple: true, id: "test", class: "w-full"
          -# multiple: true, id: "test", class: "w-full"

          -# = f.select :niche_list, {}, {}, id: "test", class: "w-full", value: '[{"id":"IN","title":"India"}]'
          -# %select{name: 'niche_list[]', id: "test", multiple: true, class: "w-full", value: '[{"id":"IN","title":"India"}]'}

        = f.submit "Update â†’", class: "my-12 w-full text-sm font-semibold text-white bg-primary rounded-sm py-2 uppercase"


      -# Right Column
      -# %div{class: "w-1/2 flex-shrink-0 flex flex-wrap "}
      -#   %div{class: "mt-10 text-2xl font-bold w-full"}
      -#     Preview ðŸ‘‡
      -#   %div{class: "mt-6"}
      -#     = render 'solutions/preview'


:javascript
  function updateIndustries() {
    $.ajax({
      method: "GET",
      url: "preview_industries",
      data: { niches: document.getElementById("industry_input").value }
    })
  }

  function updateOccupations() {
    $.ajax({
      method: "GET",
      url: "preview_occupations",
      data: { niches: document.getElementById("occupation_input").value }
    })
  }

  function sendVideosPreviewRequest() {
    var video_url_inputs = document.getElementsByClassName("video_url");
    var video_urls = "";
    document.querySelectorAll('.video_url').forEach(function(input) {
      var input_text = input.value;
      if (input_text.length == 0 ) {

      } else {
        video_urls += `, ${input_text}`;
      }
    });
    $.ajax({
      method: "POST",
      url: "preview_videos",
      data: { videos: video_urls }
    })
  }

  $( document ).on('turbolinks:load', function() {

    $("#add_video").on('click', function() {
      var regexp, time;
      time = new Date().getTime();
      regexp = new RegExp($(this).data('id'), 'g');
      $('#videos').append($(this).data('fields').replace(regexp, time));
      return event.preventDefault();
    })

    $("#videos").on('click', '.remove_url', function(event) {
      $(this).prev('input[type=hidden]').val('1');
      $(this).closest('div').hide();
      return event.preventDefault();
    });
  })
